<!DOCTYPE html>
<html>
<head>
	<title>90 Degree Game-COBA</title>
	<link rel="stylesheet" type="text/css" href="css/roboto.css">
</head>
<body>
	<canvas id="mycanvas"></canvas>
	<script src="js/lib/require.js" ></script>
	<script type="text/javascript">
	let app,lastKey=0;
	require(["js/lib/pixi.min"],function(PIXI){
			app=new PIXI.Application({
			width:360,
			height:640,
			antialias:true,
			transparent:false
		});
		document.body.appendChild(app.view);
		init();
	});
	function init(){
		app.ticker.add(loop);
		app.objects={
			character: new PIXI.Graphics(),
			text: new PIXI.Text("Game Over",{fill:"white"}),
			trail:new PIXI.Graphics()
		};
		let c=app.objects.character;
		c.beginFill(0xffffff);
		c.drawRect(0,0,16,16);
		c.endFill();
		//c.anchor.set(0.5,0.5);
		c.position.set(app.view.width/2,app.view.height*2/3);
		c.vx=1;
		app.objects.character.visible=false;
		app.stage.addChild(app.objects.character);
		app.objects.text.anchor.set(0.5,0.5);
		app.objects.text.position.set(app.view.width/2,app.view.height/2);
		app.objects.text.visible=false;
		app.stage.addChild(app.objects.text);
		app.objects.trail.trails=[];
		app.stage.addChild(app.objects.trail);
		document.addEventListener("keydown",function(event){
			if(event.timeStamp-lastKey>50){
				//console.info("Move Right: ",app.objects.character.moveRight);
				//console.log(event.timeStamp);
				//console.info(event.keyCode);
				if(event.keyCode===32){
					app.objects.character.vx*=-1;
					console.info("vx: ",app.objects.character.vx);
					app.objects.trail.trails.push(new PIXI.Point(app.objects.character.position.x,app.objects.character.position.y));
				}
			}
			lastKey=event.timeStamp;
		},false);
		app.objects.trail.trails.push(new PIXI.Point(app.objects.character.position.x,app.objects.character.position.y));
	}
	let lastlog=0;
	function loop(){
		if(app.objects.character.position.x<(0)||app.objects.character.position.x>(app.view.width-app.objects.character.width)){
			app.objects.text.visible=true;
		}
		else{
			app.objects.character.position.x+=app.objects.character.vx;
			app.objects.trail.clear();
			app.objects.trail.lineStyle(4,0xffffff,1);
			app.objects.trail.moveTo(app.objects.character.position.x,app.objects.character.position.y)
			//app.objects.trail.trails.reverse().forEach((item)=>{
				//item.x+=Math.abs(app.objects.character.vx);
				//item.y+=Math.abs(app.objects.character.vx);
				//app.objects.trail.lineTo(item.x,item.y);
			//});
			for(let i=app.objects.trail.trails.length-1;i>=0;i--){
				//app.objects.trail.trails[i].x+=Math.abs(app.objects.character.vx);
				if(app.objects.trail.trails[i].y>app.view.height&&app.objects.trail.trails[i+1]){
					if(app.objects.trail.trails[i+1].y>app.view.height){
						app.objects.trail.trails.splice(i,1);
					}
				}
				app.objects.trail.trails[i].y+=Math.abs(app.objects.character.vx);
				app.objects.trail.lineTo(app.objects.trail.trails[i].x,app.objects.trail.trails[i].y);
			}
		}
		if(app.ticker.lastTime-lastlog>1000){
			console.log("Trail array:",app.objects.trail.trails.length);
			lastlog=app.ticker.lastTime;
		}
	}
	</script>
</body>
</html>